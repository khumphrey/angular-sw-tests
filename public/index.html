<!DOCTYPE html>
<html>

<head>
    <title>Super Simple ServiceWorker</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="style.css">
    <script src="/node_modules/angular/angular.min.js"></script>
    <script src="/node_modules/angular-ui-router/release/angular-ui-router.min.js"></script>
    <script src="/angular/app.js"></script>
    <script src="/angular/state.js"></script>
</head>

<body ng-app="simple">
    <div ng-controller="main"> {{working}} </div>
    <h1>Super simple ServiceWorker</h1>
    <img src="/doc-imgs/Hippo.jpg" alt="Ew">
    <p>And now, some content added via JavaScript:</p>
    <script src="script.js"></script>
    <script>
    function isOnline(no, yes) {
        var xhr = XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHttp');
        xhr.onload = function() {
            if (yes instanceof Function) {
                yes();
            }
        }
        xhr.onerror = function() {
            if (no instanceof Function) {
                no();
            }
        }
        xhr.open("GET", "anypage.php", true);
        xhr.send();
    }

    function onlineSuccess() {
        // Let's register our serviceworker
        navigator.serviceWorker.getRegistration('../').then(function(reg) {
                console.log('Unregistering ServiceWorker');
                return reg && reg.unregister();
            })
            .then(function() {
                return navigator.serviceWorker.getRegistration();
            })
            .then(function(reg) {
                return reg && reg.unregister();
            })
            .then(function(reg) {
                console.log('Clearing caches');
                return navigator.serviceWorker.register('clear.js', {
                    scope: './'
                })
            })
            .then(function(reg) {
                reg.addEventListener('updatefound', function() {
                    var installing = reg.installing;
                    reg.installing.addEventListener('statechange', function() {
                        if (installing.state == 'installed') {
                            console.log('Done!');
                            reg.unregister();
                        }
                    });
                });
            })
            .then(function() {
                navigator.serviceWorker.register('/sw.js', {
                    // The scope cannot be parent to the script url
                    scope: '/'
                });
            })
    };

    isOnline(
        function() {
            console.log("Sorry, we currently do not have Internet access.");
        },
        onlineSuccess
    );
    </script>
    <script src="logging.js"></script>
    <button ui-sref="pony">Click Me for Pony</button>
    <ui-view></ui-view>
</body>
</ht